/** * Created by jbmar on 16/05/2017. */function submitForm() {    $('#frmUploader').ajaxSubmit({        success: showResponse    });    return false;}function showResponse(responseText, statusText, xhr, $form) {    var dataRes = JSON.parse(xhr.responseText),        divError = $("#error")    ;    if ((dataRes.isErr === 0 || dataRes.isErr === 1) && (dataRes.response)) {        divError.removeClass('red green');        dataRes.isErr === 1 ?            divError.addClass('red') : divError.addClass('green');        dataRes.isErr === 1 ?            divError.text(dataRes.response) : divError.text(dataRes.response.mess);        if (dataRes.response.srcPhoto) {            let button = document.createElement("button"),                img = dataRes.response.srcPhoto,                countElems = document.querySelectorAll('#photos-user-account .container-photos div'),                name = dataRes.response.idPhoto            ;            button.className = 'div-photo-user';            button.id = name;            button.onclick = function () {                interactPhoto(name)            };            button.onblur = function () {                closeInteract()            };            interactPhoto(name)                .then(() => {                    closeInteract();                    putOnclickOnButtonDelAndProfil(name)                        .then(() => {                            $('label').before(button);                            $('#' + name).css('background-image', 'url("' + img + '")');                            if (countElems.length === 5) {                                $('#input-file-trigger').css('display', 'none');                            }                            interactPhoto(name)                                .then(() => {                                    closeInteract();                                })                        })                })        }    }}function interactPhoto(photoId) {    return new Promise((resolve) => {        let divContainer = document.createElement('div'),            div = document.createElement('div')        ;        putOnclickOnButtonDelAndProfil(photoId)            .then(() => {                if (!$('#div-container-interact').length) {                    $('button').removeClass('profil');                    divContainer.className = 'div-container-interact';                    divContainer.id = 'div-container-interact';                    div.className = 'interact-photo';                    div.id = 'interact-photo';                    $('#interact-photos').append(divContainer)                    $('#' + divContainer.id).append(div);                    $('#interact-photos').addClass('devellop');                    $('#' + photoId).addClass('profil');                }                resolve();            });    })}function putOnclickOnButtonDelAndProfil(photoId) {    return new Promise((resolve) => {        $('#button-del-account').click(function () { removePhoto(photoId); });        $('#button-profil-account').click(function () { addFavoritePhoto(photoId); });        resolve();    });}function closeInteract() {    $('#button-del-account').mousedown(function(){return false;});    $('#button-profil-account').mousedown(function(){return false;});    $('#div-container-interact').remove();    $('button').removeClass('profil');    $('#interact-photos').removeClass('devellop');}function removePhoto(idPhoto) {    $.post('/account/Delete', { id: idPhoto }, function (data, textStatus, jqXHR) {        var dataRes = JSON.parse(jqXHR.responseText),            divError = $("#error")        ;        divError.removeClass('red green');        dataRes.isErr === 1 ? divError.addClass('red') : divError.addClass('green');        divError.text(dataRes.response);        $('#button-del-account').prop('onclick',null).off('click');        $('#' + idPhoto).remove();    });}function addFavoritePhoto(idPhoto) {    $.post('/account/Favorite', { id: idPhoto }, function (data, textStatus, jqXHR) {        var dataRes = JSON.parse(jqXHR.responseText),            divError = $("#error")        ;        console.log(dataRes.response);        if (dataRes.response !== 0 && dataRes.response !== 1){            divError.removeClass('red green');            dataRes.isErr === 1 ? divError.addClass('red') : divError.addClass('green');            divError.text(dataRes.response);        }        $('#button-profil-account').prop('onclick',null).off('click');        $('#imgStar').remove();        $('#' + idPhoto).removeClass('star');        let star = document.createElement('i');        star.id = "imgStar";        star.className = "imgStar";        star.src = "/images/tools/star.png";        $('#' + idPhoto).append(star);        $('#' + idPhoto).addClass('star');    });}